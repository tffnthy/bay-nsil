<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Listings | BaynSil Marketplace</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            }
          }
        }
      }
    }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
    }
    .sidebar {
      background: linear-gradient(180deg, #7b9aff 0%, #f3f4f6 100%);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .nav-item {
      transition: all 0.2s ease;
    }
    .nav-item:hover {
      transform: translateX(4px);
    }
  </style>
</head>
<body class="text-gray-800">
  <!-- Top Navigation Bar -->
  <header class="sticky top-0 z-10 bg-white shadow-sm">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <svg class="h-10 w-auto" viewBox="0 0 340 211" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0 C11.00528463 8.42257957 20.84908729 19.91507927 23 34 C23.42149777 38.85597514 23.56589759 43.68962957 23.625 48.5625 C23.64820313 49.78114746 23.67140625 50.99979492 23.6953125 52.25537109 C23.58764302 64.73998399 19.55634308 75.13207639 12 85 C11.55011719 85.61359375 11.10023438 86.2271875 10.63671875 86.859375 C2.63245463 97.05071974 -10.36385223 103.75514712 -23 106 C-40.73385077 107.64471561 -56.32356334 105.17560106 -70.58984375 93.96484375 C-79.54566459 86.32882809 -85.02244355 77.55845307 -90 67 C-90.33 70.96 -90.66 74.92 -91 79 C-93.64 79 -96.28 79 -99 79 C-99 70.09 -99 61.18 -99 52 C-96.36 52 -93.72 52 -91 52 C-91.05800781 50.92363281 -91.11601562 49.84726563 -91.17578125 48.73828125 C-91.5496288 38.76710204 -90.57457996 31.07635492 -86 22 C-85.56558594 21.11828125 -85.13117188 20.2365625 -84.68359375 19.328125 C-76.91833108 5.08074847 -63.78971003 -3.95913077 -48.5 -8.5 C-31.88331231 -12.34121573 -14.17268507 -9.8439735 0 0 Z" fill="#0771FE" transform="translate(317,54)"/>
          <path d="M0 0 C1.14115548 0.00427978 1.14115548 0.00427978 2.30536461 0.00864601 C10.12051437 0.07473008 17.89084912 0.56494041 25.68212891 1.14990234 C27.16561577 1.25753629 28.64912671 1.36483891 30.13265991 1.47183228 C33.20333963 1.69474959 36.2736443 1.9221484 39.34375 2.15283203 C43.26207343 2.44679863 47.18118192 2.72830289 51.10065651 3.00644493 C54.1483393 3.22424377 57.1954789 3.44900361 60.24250412 3.67580032 C61.68791802 3.78247696 63.1334979 3.88693093 64.57924271 3.98902512 C66.5953411 4.13235136 68.61068343 4.28619371 70.62597656 4.44042969 C72.33776596 4.56700455 72.33776596 4.56700455 74.08413696 4.69613647 C77.70654093 5.1672324 80.95168456 5.89629178 84.39306641 7.12646484 C87.07233982 11.14537497 86.54907889 13.36808407 86.39306641 18.12646484 C87.69244141 18.18833984 88.99181641 18.25021484 90.33056641 18.31396484 C97.46750729 19.13314202 103.04232247 22.30361115 107.83056641 27.62646484 C111.72853279 32.63659338 113.04605851 36.70537584 112.39306641 43.12646484 C111.73242317 44.52500395 111.02116634 45.90046462 110.26806641 47.25146484 C108.50422685 50.32812113 108.50422685 50.32812113 109.01806641 53.81396484 C109.47181641 54.57708984 109.92556641 55.34021484 110.39306641 56.12646484 C112.63697092 60.8635966 113.34546688 65.01609367 111.77587891 70.14208984 C108.81329221 77.01109616 103.60084764 80.18843035 97.39306641 83.93896484 C93.65829398 85.41731226 90.38964307 85.78193237 86.39306641 86.12646484 C86.47556641 87.01333984 86.55806641 87.90021484 86.64306641 88.81396484 C86.32815616 92.98652562 85.38533922 94.23834114 82.39306641 97.12646484 C79.76106857 97.77769286 77.64261852 98.08835063 74.97509766 98.24365234 C73.34819934 98.38138042 71.72141651 98.52047686 70.09472656 98.66064453 C68.73979095 98.76693176 68.73979095 98.76693176 67.35748291 98.87536621 C62.93151815 99.25026417 58.52004668 99.7439439 54.10494995 100.22857666 C49.06125648 100.78158713 44.01509718 101.31032355 38.96899414 101.84082031 C36.36748061 102.11555791 33.76624301 102.39292036 31.1652832 102.67285156 C27.34993913 103.0831345 23.53374958 103.48456666 19.71728516 103.88427734 C18.57216965 104.00924591 17.42705414 104.13421448 16.24723816 104.26296997 C10.61188648 104.84418038 4.97159188 105.29324834 -0.68969727 105.51660156 C-1.72962326 105.56340057 -2.76954926 105.61019958 -3.84098816 105.65841675 C-6.60693359 105.12646484 -6.60693359 105.12646484 -8.88398743 102.79202271 C-21.98230285 82.52771131 -15.41175886 52.25853071 -13.73193359 29.68896484 C-13.64525421 28.50870728 -13.55857483 27.32844971 -13.4692688 26.11242676 C-13.21587063 22.72164638 -12.94919545 19.33220903 -12.67724609 15.94287109 C-12.60002823 14.91168655 -12.52281036 13.88050201 -12.44325256 12.81806946 C-12.32342262 11.38626595 -12.32342262 11.38626595 -12.20117188 9.92553711 C-12.13455353 9.09208267 -12.06793518 8.25862823 -11.9992981 7.3999176 C-11.57746816 4.95573517 -10.90735068 3.23340901 -9.60693359 1.12646484 C-6.54638082 -0.40381155 -3.35564503 -0.02078973 0 0 Z" fill="#161616" transform="translate(15.60693359375,43.87353515625)"/>
          <path d="M0 0 C11.00528463 8.42257957 20.84908729 19.91507927 23 34 C23.42149777 38.85597514 23.56589759 43.68962957 23.625 48.5625 C23.64820313 49.78114746 23.67140625 50.99979492 23.6953125 52.25537109 C23.60090851 63.2018083 20.74984041 73.25020687 14 82 C13.67 81.34 13.34 80.68 13 80 C13.99 78.515 13.99 78.515 15 77 C15.3446156 74.47272837 15.3446156 74.47272837 15.35400391 71.6015625 C15.37967438 70.49611084 15.40534485 69.39065918 15.43179321 68.25170898 C15.44656708 67.05489502 15.46134094 65.85808105 15.4765625 64.625 C15.49270599 63.39015869 15.50884949 62.15531738 15.52548218 60.88305664 C15.5531712 58.26372903 15.57461226 55.64432914 15.59033203 53.02490234 C15.61665626 49.04281863 15.71237642 45.06321171 15.80078125 41.08203125 C15.821047 38.53387853 15.83807549 35.98569761 15.8515625 33.4375 C15.88657867 32.25687988 15.92159485 31.07625977 15.95767212 29.85986328 C15.91099319 20.83966254 13.10764841 15.56638192 7 9 C-4.74203174 -1.97070676 -18.06589213 -7.6063741 -34.125 -7.25 C-35.06214844 -7.24484375 -35.99929688 -7.2396875 -36.96484375 -7.234375 C-42.3873954 -7.17370309 -47.63456275 -6.78272261 -53 -6 C-38.25432969 -15.83044688 -13.49311884 -9.37196471 0 0 Z" fill="#2784FF" transform="translate(317,54)"/>
        </svg>
        <span class="text-2xl font-bold text-primary-600 ">BaynSil</span>
      </div>
      
      <!-- Search bar on right -->
      <div class="w-full max-w-md">
        <div class="relative flex items-center">
          <input
            type="text"
            placeholder="Search your listings..."
            class="w-full pl-4 pr-10 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
          />
          <button class="absolute right-0 mr-2 p-1 text-primary-600 hover:text-primary-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- User actions -->
      <div class="flex items-center space-x-4">
        <button class="p-2 text-gray-600 hover:text-primary-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
          </svg>
        </button>
        <button class="p-2 text-gray-600 hover:text-primary-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="sidebar w-64 min-h-screen hidden md:block">
      <nav class="p-4">
        <ul class="space-y-2 mt-6">
          <li>
            <a href="/views/homepage.html" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
              </svg>
              <span class="font-medium">Shop</span>
            </a>
          </li>
          <li>
            <a href="/views/useritems.html" class="nav-item flex items-center px-4 py-3 text-primary-600 bg-primary-50 rounded-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              <span class="font-medium">My Listings</span>
            </a>
          </li>
          <li>
            <a href="/views/addlisting.html" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              <span class="font-medium">Post Item</span>
            </a>
          </li>
          <li>
            <a href="#" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg">
              <svg class="w-5 w-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
              </svg>
              <span class="font-medium">Messages</span>
            </a>
          </li>
          <li>
            <a href="#" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
              </svg>
              <span class="font-medium">Favorites</span>
            </a>
          </li>
          <li>
            <a href="#" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:text-primary-600 hover:bg-primary-50 rounded-lg">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span class="font-medium">Profile</span>
            </a>
          </li>
        </ul>
        
        <div class="mt-8 pt-4 border-t border-gray-200">
          <a href="/logout" class="nav-item flex items-center px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <span class="font-medium">Log Out</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 bg-gray-50">
      <div class="container mx-auto">
        <!-- Page Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">My Listings</h1>
            <p class="text-gray-600 mt-1">Manage your posted items</p>
          </div>
          
          <div class="mt-4 md:mt-0 flex items-center space-x-4">
            <a href="/views/addlisting.html" class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add New Item
            </a>
          </div>
        </div>

        <!-- User Info -->
        <div id="user-info" class="bg-white p-4 rounded-lg shadow-sm mb-6 hidden">
          <div class="flex items-center">
            <div class="mr-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div>
              <h3 id="user-name" class="text-lg font-medium text-gray-900">Loading...</h3>
              <p id="user-listings-count" class="text-gray-600">Loading your listings...</p>
            </div>
          </div>
        </div>

        <!-- Listings Grid -->
        <div id="listings-container" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
          <!-- Listing cards will be dynamically inserted here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-12">
          <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">No listings yet</h3>
          <p class="mt-1 text-sm text-gray-500">Get started by posting your first item.</p>
          <div class="mt-6">
            <a href="/views/addlisting.html" class="inline-flex items-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Post New Item
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    // Category and subcategory data
    const categories = {
      "Electronics": ["Phones", "TVs", "Cameras"],
      "Home Appliances": ["Refrigerators", "Washing Machines", "Microwaves"],
      "Toys, Games & Collectibles": ["Action Figures", "Board Games"],
      "Clothing": ["MENS", "WOMENS", "GIRLS", "BOYS", "BABY"],
      "Shoes": ["MENS", "WOMENS", "KIDS"],
      "Mobile Gadgets": ["Action Figures", "Board Games"],
      "Laptops & Computers": ["MONITOR", "KEYBOARD AND MOUSE", "WOMENS"]
    };

    // Current user
    let currentUser = null;

    // Load items when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Get current user from localStorage
      currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      if (currentUser) {
        // Display user info
        document.getElementById('user-info').classList.remove('hidden');
        document.getElementById('user-name').textContent = currentUser.name || 'User';
        
        // Load user's items
        loadUserItems();
        
        // Add event listener for search
        const searchInput = document.querySelector('input[type="text"]');
        if (searchInput) {
          searchInput.addEventListener('input', function() {
            filterItems(this.value);
          });
        }
      } else {
        // Redirect to login if no user is logged in
        window.location.href = '/views/login.html';
      }
    });

    // Load user's items
    function loadUserItems() {
      if (!currentUser) return;
      
      const itemsContainer = document.getElementById('listings-container');
      const emptyState = document.getElementById('empty-state');
      
      // Get items from localStorage for this specific user
      const userItemsKey = `userItems_${currentUser.id}`;
      const items = JSON.parse(localStorage.getItem(userItemsKey)) || [];
      
      // Update listings count
      document.getElementById('user-listings-count').textContent = 
        `You have ${items.length} ${items.length === 1 ? 'listing' : 'listings'}`;
      
      if (items.length === 0) {
        itemsContainer.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      itemsContainer.classList.remove('hidden');
      itemsContainer.innerHTML = ''; // Clear existing items
      
      // Add each item to the container
      items.forEach(item => {
        const itemElement = createItemElement(item);
        itemsContainer.appendChild(itemElement);
      });
    }
    
    function createItemElement(item) {
      const itemElement = document.createElement('div');
      itemElement.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300';
      
      itemElement.innerHTML = `
        <div class="bg-gray-100 h-48 flex items-center justify-center relative overflow-hidden">
          ${item.image ? 
            `<img src="${item.image}" alt="${item.name}" class="h-full w-full object-contain p-4">` : 
            `<span class="text-gray-500">Product Image</span>`}
          <div class="absolute top-2 right-2 flex space-x-1">
            <button class="edit-btn p-1 bg-white rounded-full shadow-md hover:bg-gray-100" data-id="${item.id}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
              </svg>
            </button>
            <button class="delete-btn p-1 bg-white rounded-full shadow-md hover:bg-gray-100" data-id="${item.id}">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </div>
        <div class="p-4">
          <h3 class="font-semibold text-lg mb-1">${item.name}</h3>
          <p class="text-gray-600 text-sm mb-2">${item.mainCategory || 'General'}${item.subCategory ? ' > ' + item.subCategory : ''}</p>
          <div class="flex justify-between items-center">
            <span class="font-bold text-primary-600">$${item.price}</span>
            <span class="text-xs ${item.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} px-2 py-1 rounded-full">${item.status}</span>
          </div>
          <button class="view-details-btn mt-3 text-sm text-primary-600 hover:text-primary-800 w-full text-left" data-id="${item.id}">
            See more details →
          </button>
        </div>
      `;
      
      // Add event listeners
      itemElement.querySelector('.delete-btn').addEventListener('click', function() {
        deleteItem(item.id);
      });
      
      itemElement.querySelector('.edit-btn').addEventListener('click', function() {
        showEditForm(item);
      });
      
      itemElement.querySelector('.view-details-btn').addEventListener('click', function() {
        showItemDetails(item);
      });
      
      return itemElement;
    }
    
    function deleteItem(itemId) {
      if (confirm('Are you sure you want to delete this item?')) {
        const userItemsKey = `userItems_${currentUser.id}`;
        let items = JSON.parse(localStorage.getItem(userItemsKey)) || [];
        items = items.filter(item => item.id !== itemId);
        localStorage.setItem(userItemsKey, JSON.stringify(items));
        
        // Also remove from all products
        let allProducts = JSON.parse(localStorage.getItem('allProducts')) || [];
        allProducts = allProducts.filter(item => item.id !== itemId);
        localStorage.setItem('allProducts', JSON.stringify(allProducts));
        
        loadUserItems(); // Refresh the list
      }
    }
    
    function filterItems(searchTerm) {
      const userItemsKey = `userItems_${currentUser.id}`;
      const items = JSON.parse(localStorage.getItem(userItemsKey)) || [];
      const filteredItems = items.filter(item => 
        item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        (item.mainCategory && item.mainCategory.toLowerCase().includes(searchTerm.toLowerCase())) ||
        (item.subCategory && item.subCategory.toLowerCase().includes(searchTerm.toLowerCase())) ||
        item.price.toString().includes(searchTerm) ||
        (item.description && item.description.toLowerCase().includes(searchTerm.toLowerCase()))
      );
      
      const itemsContainer = document.getElementById('listings-container');
      itemsContainer.innerHTML = '';
      
      if (filteredItems.length === 0) {
        itemsContainer.innerHTML = '<p class="col-span-full text-center py-8 text-gray-500">No items match your search</p>';
      } else {
        filteredItems.forEach(item => {
          const itemElement = createItemElement(item);
          itemsContainer.appendChild(itemElement);
        });
      }
    }
    
    // Modal for item details
    function showItemDetails(item) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-2xl font-bold">${item.name}</h3>
              <button class="close-modal text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <div class="mb-6">
              <div class="bg-gray-100 rounded-lg h-64 flex items-center justify-center">
                ${item.image ? 
                  `<img src="${item.image}" alt="${item.name}" class="h-full w-full object-contain">` : 
                  `<span class="text-gray-500">No Image Available</span>`}
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <p class="text-sm text-gray-500">Price</p>
                <p class="font-bold text-primary-600">$${item.price}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Main Category</p>
                <p class="font-medium">${item.mainCategory || 'Not specified'}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Subcategory</p>
                <p class="font-medium">${item.subCategory || 'Not specified'}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Status</p>
                <span class="text-xs ${item.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} px-2 py-1 rounded-full">${item.status}</span>
              </div>
              <div>
                <p class="text-sm text-gray-500">Date Added</p>
                <p class="text-sm">${new Date(item.dateAdded).toLocaleDateString() || 'N/A'}</p>
              </div>
            </div>
            
            <div class="mb-6">
              <p class="text-sm text-gray-500">Description</p>
              <p class="mt-1">${item.description || 'No description provided.'}</p>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button class="edit-item-btn px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700" data-id="${item.id}">
                Edit Item
              </button>
              <button class="close-modal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                Close
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Close modal handlers
      modal.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', () => modal.remove());
      });
      
      // Edit item handler
      modal.querySelector('.edit-item-btn').addEventListener('click', () => {
        modal.remove();
        showEditForm(item);
      });
    }
    
    // Edit form modal
    function showEditForm(item) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-2xl font-bold">Edit Item</h3>
              <button class="close-modal text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <form class="edit-item-form" data-id="${item.id}">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                  <input type="text" name="name" value="${item.name}" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Price ($)</label>
                  <input type="number" name="price" value="${item.price}" step="0.01" min="0" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <!-- Main Category Dropdown -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Main Category</label>
                  <select name="mainCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="updateSubcategories(this)">
                    <option value="">Select a category</option>
                    <option value="Electronics" ${item.mainCategory === 'Electronics' ? 'selected' : ''}>Electronics</option>
                    <option value="Home Appliances" ${item.mainCategory === 'Home Appliances' ? 'selected' : ''}>Home Appliances</option>
                    <option value="Toys, Games & Collectibles" ${item.mainCategory === 'Toys, Games & Collectibles' ? 'selected' : ''}>Toys, Games & Collectibles</option>
                    <option value="Clothing" ${item.mainCategory === 'Clothing' ? 'selected' : ''}>Clothing</option>
                    <option value="Shoes" ${item.mainCategory === 'Shoes' ? 'selected' : ''}>Shoes</option>
                    <option value="Mobile Gadgets" ${item.mainCategory === 'Mobile Gadgets' ? 'selected' : ''}>Mobile Gadgets</option>
                    <option value="Laptops & Computers" ${item.mainCategory === 'Laptops & Computers' ? 'selected' : ''}>Laptops & Computers</option>
                  </select>
                </div>
                
                <!-- Subcategory Dropdown -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Subcategory</label>
                  <select name="subCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="">Select a subcategory</option>
                    ${getSubcategoryOptions(item.mainCategory, item.subCategory)}
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                  <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <option value="Active" ${item.status === 'Active' ? 'selected' : ''}>Active</option>
                    <option value="Sold" ${item.status === 'Sold' ? 'selected' : ''}>Sold</option>
                    <option value="Pending" ${item.status === 'Pending' ? 'selected' : ''}>Pending</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                  <textarea name="description" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md">${item.description || ''}</textarea>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                  <button type="button" class="close-modal px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                    Cancel
                  </button>
                  <button type="submit" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                    Save Changes
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Close modal handlers
      modal.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', () => modal.remove());
      });
      
      // Form submission
      modal.querySelector('.edit-item-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const updatedItem = {
          ...item,
          name: formData.get('name'),
          price: formData.get('price'),
          mainCategory: formData.get('mainCategory'),
          subCategory: formData.get('subCategory'),
          status: formData.get('status'),
          description: formData.get('description')
        };
        
        updateItem(updatedItem);
        modal.remove();
      });
    }
    
    // Helper function to generate subcategory options
    function getSubcategoryOptions(mainCategory, selectedSubCategory) {
      if (!mainCategory || !categories[mainCategory]) {
        return '';
      }

      return categories[mainCategory].map(subcat => 
        `<option value="${subcat}" ${selectedSubCategory === subcat ? 'selected' : ''}>${subcat}</option>`
      ).join('');
    }

    // Update subcategories when main category changes
    function updateSubcategories(selectElement) {
      const form = selectElement.closest('form');
      const mainCategory = selectElement.value;
      const subCategorySelect = form.querySelector('select[name="subCategory"]');
      
      subCategorySelect.innerHTML = '<option value="">Select a subcategory</option>';
      
      if (mainCategory) {
        const options = getSubcategoryOptions(mainCategory, '');
        subCategorySelect.innerHTML += options;
      }
    }

    // Update item in storage
    function updateItem(updatedItem) {
      const userItemsKey = `userItems_${currentUser.id}`;
      let items = JSON.parse(localStorage.getItem(userItemsKey)) || [];
      items = items.map(item => item.id === updatedItem.id ? updatedItem : item);
      localStorage.setItem(userItemsKey, JSON.stringify(items));
      
      // Also update in all products
      let allProducts = JSON.parse(localStorage.getItem('allProducts')) || [];
      allProducts = allProducts.map(item => item.id === updatedItem.id ? updatedItem : item);
      localStorage.setItem('allProducts', JSON.stringify(allProducts));
      
      loadUserItems();
    }

    // Logout functionality
    document.querySelector('a[href="/logout"]').addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem('currentUser');
      window.location.href = '/views/login.html';
    });
  </script>
</body>
</html>